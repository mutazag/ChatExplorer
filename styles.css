:root { color-scheme: light dark; }
* { box-sizing: border-box; }
body { margin: 0; font-family: system-ui, Segoe UI, Roboto, sans-serif; }
.app-header { display: flex; gap: .5rem; align-items: center; padding: .5rem 1rem; border-bottom: 1px solid rgba(0,0,0,.1); }
/* Ensure header stays above scrolling content; helps avoid occlusion */
.app-header { position: sticky; top: 0; z-index: 10; background: var(--bg); }
.logo { width: 32px; height: 32px; }
.spacer { flex: 1; }
.layout { display: grid; grid-template-columns: 360px 1fr; min-height: calc(100vh - 56px); }
.pane { padding: .75rem; overflow: auto; }
.left { border-right: 1px solid rgba(0,0,0,.1); }
.list-item { display: block; width: 100%; text-align: left; padding: .5rem .6rem; border-radius: 6px; border: 1px solid transparent; background: transparent; cursor: pointer; }
.list-item:hover { background: rgba(0,0,0,.04); }
.list-item.is-active { border-color: #3b82f6; background: rgba(59,130,246,.06); }
.msg { padding: .25rem 0; }

/* Theme variables */
:root {
  --bg: #ffffff;
  --fg: #0f172a;
  --muted: #64748b;
  --border: rgba(0,0,0,.12);
  --bubble-user: #e8f0ff;
  --bubble-assistant: #f5f7fa;
  --elev: 0 1px 2px rgba(0,0,0,.08);
}
[data-theme="dark"] {
  --bg: #0b1020;
  --fg: #e5e7eb;
  --muted: #94a3b8;
  --border: rgba(255,255,255,.18);
  --bubble-user: #1f2a44;
  --bubble-assistant: #111827;
  --elev: 0 1px 2px rgba(0,0,0,.35);
}
html, body { background: var(--bg); color: var(--fg); }
.app-header { border-bottom-color: var(--border); }
.left { border-right-color: var(--border); }
button { color: var(--fg); background: transparent; border: 1px solid var(--border); border-radius: 6px; padding: .35rem .6rem; }
button:hover { background: color-mix(in oklab, var(--bg) 92%, var(--fg) 8%); }
button:focus { outline: 2px solid #3b82f6; outline-offset: 2px; }

/* Pane hidden layout */
.layout.is-pane-hidden { grid-template-columns: 1fr; }
.layout.is-pane-hidden .left { display: none; }

/* Markdown content styles */
[data-detail] h1, [data-detail] h2, [data-detail] h3,
[data-detail] h4, [data-detail] h5, [data-detail] h6 { margin: .6rem 0 .4rem; line-height: 1.25; }
[data-detail] p { margin: .4rem 0; }
[data-detail] ul, [data-detail] ol { margin: .4rem 0; padding-inline-start: 1.25rem; }
[data-detail] pre { background: rgba(0,0,0,.04); padding: .5rem; border-radius: 6px; overflow: auto; }
[data-detail] code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

/* Markdown tables */
[data-detail] table { border-collapse: collapse; width: 100%; margin: .5rem 0; }
[data-detail] th,
[data-detail] td { border: 1px solid #ddd; padding: 4px 8px; vertical-align: top; }
[data-detail] th { background: color-mix(in oklab, canvas 92%, black 8%); }
[data-detail] th.align-left, [data-detail] td.align-left { text-align: left; }
[data-detail] th.align-center, [data-detail] td.align-center { text-align: center; }
[data-detail] th.align-right, [data-detail] td.align-right { text-align: right; }

/* Inline media styles */
[data-detail] .msg-media { margin: .4rem 0; display: grid; gap: .5rem; }
[data-detail] .msg-media img { max-width: 100%; height: auto; max-height: 40vh; object-fit: contain; border-radius: 6px; display: block; background: rgba(0,0,0,.03); }

[data-detail] .msg-media audio,
[data-detail] .msg-media video { width: 100%; max-width: 640px; outline: none; }
[data-detail] .msg-media a.media-fallback { display: inline-block; padding: .25rem .5rem; border-radius: 4px; border: 1px solid rgba(0,0,0,.15); text-decoration: none; }

/* Message bubbles by role */
[data-detail] .msg { display: grid; grid-template-columns: 1fr; gap: .2rem; }
[data-detail] { position: relative; }
[data-detail] .msg .msg-header { display: inline-flex; gap: .35rem; align-items: center; font-size: .9rem; color: var(--muted); justify-self: start; text-align: start; }
[data-detail] .msg .msg-header img { width: 18px; height: 18px; opacity: .9; }
[data-detail] .msg .bubble { display: inline-block; max-width: min(720px, 100%); padding: .5rem .65rem; border-radius: 14px; box-shadow: var(--elev); border: 1px solid var(--border); background: var(--bubble-assistant); text-align: start; }
[data-detail] .msg .bubble.bubble--media-only { min-width: 260px; }
[data-detail] .msg--assistant .bubble { background: var(--bubble-assistant); justify-self: start; }
[data-detail] .msg--user .bubble { background: var(--bubble-user); justify-self: end; }
[data-detail] .msg--user .bubble { text-align: start; }
[data-detail] .msg--user { text-align: right; }
[data-detail] .msg .timestamp { font-size: .8rem; color: var(--muted); opacity: 0; transform: translateY(-2px); transition: opacity .15s ease, transform .15s ease; justify-self: start; text-align: start; }
/* Align user header and timestamp to the right to match the bubble */
[data-detail] .msg--user .msg-header { justify-self: end; text-align: end; }
[data-detail] .msg--user .timestamp { justify-self: end; text-align: end; }
@media (prefers-reduced-motion: reduce) {
  [data-detail] .msg .timestamp { transition: none; }
}
[data-detail] .msg:hover .timestamp,
[data-detail] .msg:focus-within .timestamp,
[data-detail] .msg.is-tapped .timestamp { opacity: 1; transform: translateY(0); }
[data-detail] .msg:hover .bubble,
[data-detail] .msg:focus-within .bubble,
[data-detail] .msg.is-tapped .bubble { box-shadow: 0 4px 14px rgba(0,0,0,.12); }

/* Keep code blocks readable regardless of surrounding RTL/LTR */
[data-detail] .bubble pre,
[data-detail] .bubble code { direction: ltr; unicode-bidi: isolate; }

/* Direction-aware tweaks */
[data-detail] .msg.is-rtl .msg-header { flex-direction: row-reverse; }
/* base timestamp text alignment handled above; user variant aligns to end */

@media (max-width: 860px) {
  .layout { grid-template-columns: 1fr; }
  .left { display: none; }
  .left { border-right: none; border-bottom: 1px solid var(--border); }
  .show-left .left { display: block; }
  /* Mobile conversation picker: visible only on small screens */
  .mobile-list { display: flex; gap: .5rem; align-items: center; padding-bottom: .5rem; position: sticky; top: 0; background: var(--bg); z-index: 2; }
}

/* Hide mobile picker by default on larger screens */
.mobile-list { display: none; }

/* Data set control: hidden by default on larger screens */
.dataset-control { display: none; }

/* Mobile visibility and touch targets for data set control */
@media (max-width: 768px) {
  .dataset-control {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 44px;
    min-height: 44px;
    padding: .25rem .5rem;
    gap: .35rem;
    touch-action: manipulation;
    border: 1px solid var(--border);
    border-radius: 6px;
  }
  .dataset-control > * { pointer-events: none; }
  .dataset-control .label {
    max-width: 40vw;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-weight: 500;
  }
}

/* Dataset list styles */
.dataset-list { list-style: none; padding: 0; margin: 0; display: grid; gap: .25rem; }
.dataset-list [role="option"] { padding: .5rem .6rem; border-radius: 6px; cursor: pointer; outline: none; border: 1px solid transparent; }
.dataset-list [role="option"]:hover { background: rgba(0,0,0,.04); }
.dataset-list [role="option"]:focus { box-shadow: 0 0 0 2px #3b82f6; }
.dataset-list [role="option"].is-active { border-color: #3b82f6; background: rgba(59,130,246,.06); }
.dataset-item { display: grid; grid-template-columns: 20px 1fr auto; align-items: center; gap: .5rem; }
.dataset-item .icon { width: 20px; height: 20px; opacity: .85; }
.dataset-item .name { font-weight: 500; }
.dataset-item .meta { color: rgba(0,0,0,.6); font-size: .9rem; }

/* Tooltips (US6) */
:root {
  /* Light, slightly transparent tooltip background */
  --tooltip-bg: rgba(255,255,255,.95);
  --tooltip-fg: #0f172a;
  --tooltip-shadow: 0 8px 22px rgba(0,0,0,.14);
  --tooltip-border: rgba(0,0,0,.12);
}
[data-theme="dark"] {
  /* Keep light-ish tooltip for contrast on dark themes */
  --tooltip-bg: rgba(255,255,255,.92);
  --tooltip-fg: #0b1020;
  --tooltip-shadow: 0 10px 28px rgba(0,0,0,.45);
  --tooltip-border: rgba(0,0,0,.2);
}

/* Make role icons clearly focusable */
[data-detail] .msg .msg-header img { outline: none; border-radius: 4px; }
[data-detail] .msg .msg-header img:focus-visible {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

/* Base tooltip styles; JS sets positioning. */
[data-tooltip] {
  color: var(--tooltip-fg);
  background: var(--tooltip-bg);
  border: 1px solid var(--tooltip-border);
  border-radius: 8px;
  box-shadow: var(--tooltip-shadow);
  padding: 6px 8px;
  font-size: 12px;
  line-height: 1.25;
  white-space: pre-wrap;
  word-break: break-word;
  pointer-events: none;
  -webkit-user-select: none;
  user-select: none;
  transform: translateY(0);
  opacity: 1;
  transition: opacity .12s ease, transform .12s ease;
}

/* Arrow for bottom placement */
[data-tooltip][data-placement="bottom"]::after {
  content: "";
  position: absolute;
  top: -6px;
  left: var(--arrow-left, 12px);
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-bottom: 6px solid var(--tooltip-bg);
  filter: drop-shadow(0 -1px 0 var(--tooltip-border));
}

/* Arrow for right placement */
[data-tooltip][data-placement="right"]::after {
  content: "";
  position: absolute;
  left: -6px;
  top: 50%;
  transform: translateY(-50%);
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-right: 6px solid var(--tooltip-bg);
  filter: drop-shadow(-1px 0 0 var(--tooltip-border));
}

@media (prefers-reduced-motion: reduce) {
  [data-tooltip] { transition: none; }
}
